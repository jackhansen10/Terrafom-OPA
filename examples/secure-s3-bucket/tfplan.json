{"format_version":"1.2","terraform_version":"1.5.7","variables":{"aws_region":{"value":"us-east-1"},"bucket_name":{"value":"test"},"environment":{"value":"dev"},"kms_key_alias":{"value":"alias/example-secure-bucket"},"logging_bucket_name":{"value":"temp"},"restrict_to_vpc_endpoint_ids":{"value":[]}},"planned_values":{"root_module":{}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","version_constraint":"\u003e= 5.0.0","expressions":{"region":{"references":["var.aws_region"]}}}},"root_module":{"outputs":{"bucket_arn":{"expression":{"references":["module.secure_bucket.bucket_arn","module.secure_bucket"]}},"bucket_id":{"expression":{"references":["module.secure_bucket.bucket_id","module.secure_bucket"]}},"kms_key_arn":{"expression":{"references":["module.secure_bucket.kms_key_arn","module.secure_bucket"]}}},"module_calls":{"secure_bucket":{"source":"../../modules/secure-s3-bucket","expressions":{"bucket_name":{"references":["var.bucket_name"]},"force_destroy":{"constant_value":false},"kms_deletion_window_in_days":{"constant_value":30},"kms_key_alias":{"references":["var.kms_key_alias"]},"logging_bucket_name":{"references":["var.logging_bucket_name"]},"noncurrent_version_expiration_days":{"constant_value":90},"restrict_to_vpc_endpoint_ids":{"references":["var.restrict_to_vpc_endpoint_ids"]},"tags":{"references":["var.environment"]}},"module":{"outputs":{"bucket_arn":{"expression":{"references":["aws_s3_bucket.this.arn","aws_s3_bucket.this"]},"description":"ARN of the primary S3 bucket"},"bucket_id":{"expression":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"description":"ID of the primary S3 bucket"},"kms_key_arn":{"expression":{"references":["aws_kms_key.s3.arn","aws_kms_key.s3"]},"description":"ARN of the KMS key used for default encryption"}},"resources":[{"address":"aws_kms_alias.s3","mode":"managed","type":"aws_kms_alias","name":"s3","provider_config_key":"aws","expressions":{"name":{"references":["var.kms_key_alias"]},"target_key_id":{"references":["aws_kms_key.s3.key_id","aws_kms_key.s3"]}},"schema_version":0},{"address":"aws_kms_key.s3","mode":"managed","type":"aws_kms_key","name":"s3","provider_config_key":"aws","expressions":{"deletion_window_in_days":{"references":["var.kms_deletion_window_in_days"]},"description":{"constant_value":"KMS key for encrypting S3 objects at rest"},"enable_key_rotation":{"constant_value":true},"tags":{"references":["var.tags"]}},"schema_version":0},{"address":"aws_s3_bucket.logs","mode":"managed","type":"aws_s3_bucket","name":"logs","provider_config_key":"aws","expressions":{"bucket":{"references":["local.logging_bucket_name"]},"force_destroy":{"references":["var.force_destroy"]},"tags":{"references":["var.tags","local.logging_bucket_name"]}},"schema_version":0},{"address":"aws_s3_bucket.this","mode":"managed","type":"aws_s3_bucket","name":"this","provider_config_key":"aws","expressions":{"bucket":{"references":["var.bucket_name"]},"force_destroy":{"references":["var.force_destroy"]},"tags":{"references":["var.tags","var.bucket_name"]}},"schema_version":0},{"address":"aws_s3_bucket_acl.logs","mode":"managed","type":"aws_s3_bucket_acl","name":"logs","provider_config_key":"aws","expressions":{"acl":{"constant_value":"log-delivery-write"},"bucket":{"references":["aws_s3_bucket.logs.id","aws_s3_bucket.logs"]}},"schema_version":0,"depends_on":["aws_s3_bucket_ownership_controls.logs","aws_s3_bucket_public_access_block.logs"]},{"address":"aws_s3_bucket_lifecycle_configuration.this","mode":"managed","type":"aws_s3_bucket_lifecycle_configuration","name":"this","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"rule":[{"abort_incomplete_multipart_upload":[{"days_after_initiation":{"constant_value":7}}],"filter":[{}],"id":{"constant_value":"abort-incomplete-multipart"},"status":{"constant_value":"Enabled"}},{"filter":[{}],"id":{"constant_value":"expire-noncurrent-versions"},"noncurrent_version_expiration":[{"noncurrent_days":{"references":["var.noncurrent_version_expiration_days"]}}],"status":{"constant_value":"Enabled"}}]},"schema_version":1},{"address":"aws_s3_bucket_logging.this","mode":"managed","type":"aws_s3_bucket_logging","name":"this","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"target_bucket":{"references":["aws_s3_bucket.logs.id","aws_s3_bucket.logs"]},"target_prefix":{"constant_value":"logs/"}},"schema_version":0},{"address":"aws_s3_bucket_ownership_controls.logs","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"logs","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.logs.id","aws_s3_bucket.logs"]},"rule":[{"object_ownership":{"constant_value":"BucketOwnerPreferred"}}]},"schema_version":0},{"address":"aws_s3_bucket_ownership_controls.this","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"this","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"rule":[{"object_ownership":{"constant_value":"BucketOwnerEnforced"}}]},"schema_version":0},{"address":"aws_s3_bucket_policy.this","mode":"managed","type":"aws_s3_bucket_policy","name":"this","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"policy":{"references":["data.aws_iam_policy_document.this.json","data.aws_iam_policy_document.this"]}},"schema_version":0},{"address":"aws_s3_bucket_public_access_block.logs","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"logs","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.logs.id","aws_s3_bucket.logs"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0},{"address":"aws_s3_bucket_public_access_block.this","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"this","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0},{"address":"aws_s3_bucket_server_side_encryption_configuration.this","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"this","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":{"references":["aws_kms_key.s3.arn","aws_kms_key.s3"]},"sse_algorithm":{"constant_value":"aws:kms"}}],"bucket_key_enabled":{"constant_value":true}}]},"schema_version":0},{"address":"aws_s3_bucket_versioning.this","mode":"managed","type":"aws_s3_bucket_versioning","name":"this","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.this.id","aws_s3_bucket.this"]},"versioning_configuration":[{"status":{"constant_value":"Enabled"}}]},"schema_version":0},{"address":"data.aws_iam_policy_document.this","mode":"data","type":"aws_iam_policy_document","name":"this","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["s3:*"]},"condition":[{"test":{"constant_value":"Bool"},"values":{"constant_value":["false"]},"variable":{"constant_value":"aws:SecureTransport"}}],"effect":{"constant_value":"Deny"},"principals":[{"identifiers":{"constant_value":["*"]},"type":{"constant_value":"*"}}],"resources":{"references":["aws_s3_bucket.this.arn","aws_s3_bucket.this","aws_s3_bucket.this.arn","aws_s3_bucket.this"]},"sid":{"constant_value":"DenyInsecureTransport"}},{"actions":{"constant_value":["s3:PutObject","s3:PutObjectAcl","s3:InitiateMultipartUpload"]},"condition":[{"test":{"constant_value":"StringNotEqualsIfExists"},"values":{"constant_value":["aws:kms"]},"variable":{"constant_value":"s3:x-amz-server-side-encryption"}},{"test":{"constant_value":"StringNotEqualsIfExists"},"values":{"references":["aws_kms_key.s3.arn","aws_kms_key.s3"]},"variable":{"constant_value":"s3:x-amz-server-side-encryption-aws-kms-key-id"}}],"effect":{"constant_value":"Deny"},"principals":[{"identifiers":{"constant_value":["*"]},"type":{"constant_value":"*"}}],"resources":{"references":["aws_s3_bucket.this.arn","aws_s3_bucket.this"]},"sid":{"constant_value":"DenyUnEncryptedObjectUploads"}}]},"schema_version":0}],"variables":{"bucket_name":{"description":"Name of the primary S3 bucket. Must be globally unique."},"force_destroy":{"default":false,"description":"Allow Terraform to delete bucket with non-empty contents (not recommended for production)."},"kms_deletion_window_in_days":{"default":30,"description":"Waiting period for scheduled KMS key deletion (7-30)."},"kms_key_alias":{"default":"alias/s3-default-kms","description":"Alias to assign to the KMS key used for S3 encryption."},"logging_bucket_name":{"description":"Name for the S3 access logging bucket. Must be globally unique."},"noncurrent_version_expiration_days":{"default":90,"description":"Days to retain noncurrent object versions before expiration."},"object_expiration_days":{"default":null,"description":"Number of days after which CURRENT objects transition or expire. Use null to disable."},"restrict_to_vpc_endpoint_ids":{"default":[],"description":"Optional list of VPC endpoint IDs allowed to access the bucket. Empty disables restriction."},"tags":{"default":{},"description":"Tags to apply to all resources."}}}}},"variables":{"aws_region":{"description":"AWS region to deploy resources in."},"bucket_name":{"description":"Primary bucket name (globally unique)"},"environment":{"default":"dev","description":"Environment tag (e.g., dev, staging, prod)"},"kms_key_alias":{"default":"alias/example-secure-bucket","description":"Alias to assign to the KMS key"},"logging_bucket_name":{"description":"Access logs bucket name (globally unique)"},"restrict_to_vpc_endpoint_ids":{"default":[],"description":"Optional list of allowed VPC endpoint IDs"}}}},"timestamp":"2025-09-06T00:27:26Z"}
